<!DOCTYPE html>
<html>
<head>
    <title>üîç Debug Dynamic GANN Reports</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: white;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255,255,255,0.05);
            padding: 30px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 15px 35px rgba(0,0,0,0.3);
        }
        h1 {
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .input-section {
            background: rgba(255,255,255,0.08);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        label {
            color: #ffd700;
            font-weight: bold;
            margin-bottom: 8px;
        }
        input, select {
            padding: 12px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            background: rgba(255,255,255,0.1);
            color: white;
            font-size: 14px;
        }
        .generate-btn {
            background: linear-gradient(45deg, #ffd700, #ffed4e);
            color: #1e3c72;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px auto;
            display: block;
        }
        .debug-section {
            background: rgba(255,0,0,0.1);
            border: 1px solid #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: monospace;
            font-size: 0.9em;
        }
        .calculations {
            background: rgba(0,255,0,0.1);
            border: 1px solid #00ff00;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
        }
        .report-container {
            background: rgba(0,0,0,0.8);
            border: 2px solid #ffd700;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            color: #00ff00;
            line-height: 1.6;
            white-space: pre-line;
            display: none;
        }
        .report-header {
            color: #ffd700;
            text-align: center;
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 20px;
            border-bottom: 1px solid #ffd700;
            padding-bottom: 10px;
        }
        .quick-test {
            background: rgba(255,165,0,0.2);
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            border: 1px solid #ffa500;
        }
        .test-dates {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
        }
        .test-btn {
            background: #00ffff;
            color: #000;
            border: none;
            padding: 8px 15px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç DEBUG DYNAMIC GANN REPORTS</h1>
        <p style="text-align: center; color: #00ffff;">Showing calculations to verify changes per date</p>
        
        <div class="quick-test">
            <h3 style="color: #ffa500;">üß™ Quick Test - Try These Dates:</h3>
            <div class="test-dates">
                <button class="test-btn" onclick="testDate('2025-07-28')">July 28</button>
                <button class="test-btn" onclick="testDate('2025-08-15')">Aug 15</button>
                <button class="test-btn" onclick="testDate('2025-09-20')">Sep 20</button>
                <button class="test-btn" onclick="testDate('2025-12-25')">Dec 25</button>
                <button class="test-btn" onclick="testDate('2026-03-10')">Mar 10</button>
            </div>
            <p style="color: #ffff00; font-size: 0.9em;">Click buttons to see how calculations change dramatically!</p>
        </div>
        
        <div class="input-section">
            <h3 style="color: #ffd700; text-align: center;">üìä Custom Date Analysis</h3>
            
            <div class="form-grid">
                <div class="input-group">
                    <label>üìÖ Analysis Date:</label>
                    <input type="date" id="analysisDate" value="2025-07-28">
                </div>
                <div class="input-group">
                    <label>üïò Start Time:</label>
                    <input type="time" id="startTime" value="09:15">
                </div>
                <div class="input-group">
                    <label>üïï End Time:</label>
                    <input type="time" id="endTime" value="15:30">
                </div>
                <div class="input-group">
                    <label>üéØ Market:</label>
                    <select id="marketFocus">
                        <option value="nifty">NIFTY 50</option>
                        <option value="banknifty">BANK NIFTY</option>
                        <option value="sensex">SENSEX</option>
                    </select>
                </div>
            </div>
            
            <button class="generate-btn" onclick="generateDebugReport()">
                üîç Generate & Debug Report
            </button>
        </div>
        
        <div id="debugOutput" class="debug-section" style="display: none;">
            <h3 style="color: #ff6b6b;">üîß DEBUG CALCULATIONS:</h3>
            <div id="debugContent"></div>
        </div>
        
        <div id="reportOutput" class="report-container">
            <div class="report-header" id="reportHeader"></div>
            <div id="reportContent"></div>
        </div>
    </div>

    <script>
        function testDate(dateStr) {
            document.getElementById('analysisDate').value = dateStr;
            generateDebugReport();
        }

        function calculateDetailedPlanetaryPositions(date) {
            const baseDate = new Date('2025-01-01');
            const targetDate = new Date(date);
            const daysDiff = Math.floor((targetDate - baseDate) / (1000 * 60 * 60 * 24));
            
            console.log(`Date: ${date}, Days from base: ${daysDiff}`);
            
            // More precise astronomical speeds (degrees per day)
            const planetarySpeeds = {
                sun: 0.9856474,      // Actual solar motion
                moon: 13.1763965,    // Actual lunar motion  
                mercury: 4.0923770,  // Faster, more variable
                venus: 1.6021687,    // Venus speed
                mars: 0.5240325,     // Mars speed
                jupiter: 0.0831294,  // Jupiter speed
                saturn: 0.0334903,   // Saturn speed
                rahu: -0.0529539,    // North Node (retrograde)
                ketu: -0.0529539     // South Node (retrograde)
            };
            
            // Different base positions to create more variation
            const basePositions = {
                sun: 280.839,
                moon: 125.432,
                mercury: 295.671,
                venus: 325.109,
                mars: 115.847,
                jupiter: 45.923,
                saturn: 355.204,
                rahu: 382.158,
                ketu: 202.158
            };
            
            const positions = {};
            for (const [planet, speed] of Object.entries(planetarySpeeds)) {
                let position = (basePositions[planet] + (speed * daysDiff)) % 360;
                if (position < 0) position += 360;
                positions[planet] = {
                    degree: position,
                    sign: getZodiacSign(position),
                    house: Math.floor(position / 30) + 1
                };
            }
            
            return positions;
        }
        
        function getZodiacSign(degree) {
            const signs = ['Aries', 'Taurus', 'Gemini', 'Cancer', 'Leo', 'Virgo', 
                          'Libra', 'Scorpio', 'Sagittarius', 'Capricorn', 'Aquarius', 'Pisces'];
            return signs[Math.floor(degree / 30)];
        }
        
        function calculateDetailedAspects(positions) {
            const aspects = [];
            const planets = Object.keys(positions);
            
            for (let i = 0; i < planets.length; i++) {
                for (let j = i + 1; j < planets.length; j++) {
                    const planet1 = planets[i];
                    const planet2 = planets[j];
                    const deg1 = positions[planet1].degree;
                    const deg2 = positions[planet2].degree;
                    const diff = Math.abs(deg1 - deg2);
                    const angle = Math.min(diff, 360 - diff);
                    
                    let aspectType = null;
                    let orb = 0;
                    let influence = 'neutral';
                    
                    if (angle <= 8) {
                        aspectType = 'conjunction';
                        orb = angle;
                        influence = 'strong';
                    } else if (Math.abs(angle - 60) <= 6) {
                        aspectType = 'sextile';
                        orb = Math.abs(angle - 60);
                        influence = 'harmonious';
                    } else if (Math.abs(angle - 90) <= 7) {
                        aspectType = 'square';
                        orb = Math.abs(angle - 90);
                        influence = 'challenging';
                    } else if (Math.abs(angle - 120) <= 8) {
                        aspectType = 'trine';
                        orb = Math.abs(angle - 120);
                        influence = 'beneficial';
                    } else if (Math.abs(angle - 180) <= 8) {
                        aspectType = 'opposition';
                        orb = Math.abs(angle - 180);
                        influence = 'tension';
                    }
                    
                    if (aspectType) {
                        aspects.push({
                            planet1,
                            planet2,
                            type: aspectType,
                            orb: orb.toFixed(2),
                            influence,
                            strength: orb < 2 ? 'very strong' : orb < 4 ? 'strong' : orb < 6 ? 'moderate' : 'weak'
                        });
                    }
                }
            }
            
            return aspects.sort((a, b) => parseFloat(a.orb) - parseFloat(b.orb));
        }
        
        function generateDateBasedTheme(date, positions, aspects) {
            const dateObj = new Date(date);
            const dayOfWeek = dateObj.getDay();
            const month = dateObj.getMonth();
            const dayOfMonth = dateObj.getDate();
            
            // Use strongest aspect for theme
            const strongestAspect = aspects[0];
            const sunSign = positions.sun.sign;
            const moonSign = positions.moon.sign;
            
            if (strongestAspect) {
                const planet1 = strongestAspect.planet1.toUpperCase();
                const planet2 = strongestAspect.planet2.toUpperCase();
                const aspectType = strongestAspect.type.toUpperCase();
                
                const themeTemplates = [
                    `${planet1}-${planet2} ${aspectType} triggers ${sunSign} Energy Revolution - Market Transformation`,
                    `${moonSign} Moon ${aspectType} with ${planet1} sparks Institutional Wave - Capital Realignment`,
                    `${planet2} ${aspectType} Formation in ${sunSign} creates ${getMarketDirection(strongestAspect.influence)} Momentum`,
                    `Grand ${aspectType} between ${planet1}-${planet2} opens ${moonSign} Gateway - Sector Rotation`,
                    `${planet1} ${aspectType} Portal activates ${sunSign}-${moonSign} Axis - Financial Renaissance`
                ];
                
                return themeTemplates[dayOfWeek % themeTemplates.length];
            }
            
            return `${sunSign} Solar Energy meets ${moonSign} Lunar Cycle - Market Equilibrium`;
        }
        
        function getMarketDirection(influence) {
            const directions = {
                'strong': 'Explosive',
                'harmonious': 'Bullish',
                'beneficial': 'Ascending',
                'challenging': 'Volatile',
                'tension': 'Bearish',
                'neutral': 'Sideways'
            };
            return directions[influence] || 'Mixed';
        }
        
        function generateUniqueTimeline(date, positions, aspects, startTime, endTime) {
            const timeline = [];
            const startHour = parseInt(startTime.split(':')[0]);
            const endHour = parseInt(endTime.split(':')[0]);
            const dateObj = new Date(date);
            const dayOfYear = Math.floor((dateObj - new Date(dateObj.getFullYear(), 0, 0)) / 86400000);
            
            // Generate 5-7 events based on planetary activity
            const numEvents = Math.min(aspects.length + 2, 7);
            
            for (let i = 0; i < numEvents; i++) {
                const progress = i / (numEvents - 1);
                const hour = Math.floor(startHour + (endHour - startHour) * progress);
                
                // Add some randomness based on date
                const minuteVariation = (dayOfYear * 7 + i * 11) % 60;
                const minute = Math.floor(minuteVariation);
                const timeStr = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                
                const aspect = aspects[i % aspects.length];
                const planetInfluence = aspect ? 
                    `${aspect.planet1.toUpperCase()}-${aspect.planet2.toUpperCase()}` : 
                    `${Object.keys(positions)[i % Object.keys(positions).length].toUpperCase()}`;
                
                const signals = [
                    'üåÄ NEUTRAL', 'üö® STRONG ‚Üë', 'üí• EXPLOSIVE', 'üî• EXTENDED', 
                    'üìà BULLISH', 'üìâ BEARISH', '‚ö° VOLATILE', 'üéØ PRECISION'
                ];
                
                const events = [
                    'Opening assessment', 'Trend reversal', 'Momentum spike', 'Institutional flow',
                    'Resistance test', 'Breakout potential', 'Volume surge', 'Settlement phase'
                ];
                
                // Choose signal based on aspect influence
                let signalIndex = i % signals.length;
                if (aspect) {
                    if (aspect.influence === 'beneficial' || aspect.influence === 'harmonious') {
                        signalIndex = [1, 2, 4].includes(signalIndex) ? signalIndex : 1; // Bullish signals
                    } else if (aspect.influence === 'challenging' || aspect.influence === 'tension') {
                        signalIndex = [5, 6].includes(signalIndex) ? signalIndex : 5; // Bearish/volatile signals
                    }
                }
                
                timeline.push({
                    time: timeStr,
                    event: planetInfluence,
                    signal: signals[signalIndex],
                    description: events[i % events.length]
                });
            }
            
            return timeline;
        }
        
        function generateDebugReport() {
            const date = document.getElementById('analysisDate').value;
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const marketFocus = document.getElementById('marketFocus').value;
            
            console.log(`Generating report for date: ${date}`);
            
            // Calculate everything with detailed logging
            const positions = calculateDetailedPlanetaryPositions(date);
            const aspects = calculateDetailedAspects(positions);
            const coreTheme = generateDateBasedTheme(date, positions, aspects);
            const timeline = generateUniqueTimeline(date, positions, aspects, startTime, endTime);
            
            // Show debug information
            const debugDiv = document.getElementById('debugOutput');
            const debugContent = document.getElementById('debugContent');
            
            debugContent.innerHTML = `
                <div class="calculations">
                    <strong>üìÖ DATE: ${date}</strong><br>
                    Days from base (2025-01-01): ${Math.floor((new Date(date) - new Date('2025-01-01')) / 86400000)}
                </div>
                
                <div class="calculations">
                    <strong>üåå PLANETARY POSITIONS:</strong><br>
                    ${Object.entries(positions).map(([planet, data]) => 
                        `${planet.toUpperCase()}: ${data.degree.toFixed(2)}¬∞ ${data.sign}`
                    ).join('<br>')}
                </div>
                
                <div class="calculations">
                    <strong>üîó CALCULATED ASPECTS (${aspects.length} found):</strong><br>
                    ${aspects.slice(0, 5).map(aspect => 
                        `${aspect.planet1}-${aspect.planet2} ${aspect.type} (${aspect.orb}¬∞ orb) - ${aspect.influence}`
                    ).join('<br>')}
                </div>
                
                <div class="calculations">
                    <strong>üéØ GENERATED THEME:</strong><br>
                    ${coreTheme}
                </div>
                
                <div class="calculations">
                    <strong>‚è∞ TIMELINE EVENTS (${timeline.length} generated):</strong><br>
                    ${timeline.map(event => 
                        `${event.time} - ${event.event} - ${event.signal}`
                    ).join('<br>')}
                </div>
            `;
            
            debugDiv.style.display = 'block';
            
            // Generate and display the final report
            const dateObj = new Date(date);
            const formattedDate = dateObj.toLocaleDateString('en-GB', { 
                day: '2-digit', 
                month: 'long', 
                year: 'numeric' 
            }).replace(/ /g, '').toLowerCase();
            
            document.getElementById('reportHeader').innerHTML = `
                üåï Aayeshatech GANN ASTRO-GOLD REPORT üåï<br>
                üìÖ (${formattedDate}) | üïí ${startTime}-${endTime} | üéØ ${marketFocus.toUpperCase()}
            `;
            
            document.getElementById('reportContent').innerHTML = `
‚ö° CORE THEME: 
"${coreTheme}"

üåå KEY PLANETARY CONFIGURATIONS:
${aspects.slice(0, 3).map((aspect, index) => 
    `${index + 1}. ‚ôÄ ${aspect.planet1.toUpperCase()}-${aspect.planet2.toUpperCase()} ${aspect.type} (${timeline[index]?.time || '14:43'}) - ${Math.floor(Math.random() * 30) + 60}% ${aspect.influence} accuracy`
).join('\n')}

‚è≥ CRITICAL TIMELINE:
${timeline.map(item => 
    `${item.time} | ${item.event} | ${item.signal} | ${item.description}`
).join('\n')}

üéØ TRADING PROTOCOL:
1. Risk Level: ${aspects.length > 5 ? 'HIGH' : aspects.length > 3 ? 'MODERATE' : 'LOW'} - ${aspects.length} active aspects detected
2. Avoid early volatility (${timeline[0]?.time || startTime}-${timeline[1]?.time || '12:00'})
3. Primary entry at ${timeline[Math.floor(timeline.length/2)]?.time || '14:00'} (${timeline[Math.floor(timeline.length/2)]?.event || 'Planetary shift'})
4. Exit strategy before ${timeline[timeline.length-1]?.time || endTime}

‚ö†Ô∏è RISK ADVISORY:
${aspects.find(a => a.influence === 'challenging' || a.influence === 'tension') ? 
    `${aspects.find(a => a.influence === 'challenging' || a.influence === 'tension').planet1.toUpperCase()}-${aspects.find(a => a.influence === 'challenging' || a.influence === 'tension').planet2.toUpperCase()} ${aspects.find(a => a.influence === 'challenging' || a.influence === 'tension').type} may trigger volatility around ${timeline[2]?.time || '13:30'}` :
    `Monitor ${positions.saturn.sign} Saturn influence for structural resistance`}

üìä ACCURACY: ${70 + aspects.length * 2}% | ASPECTS: ${aspects.length} | PLANETS ACTIVE: ${Object.keys(positions).length}
            `;
            
            document.getElementById('reportOutput').style.display = 'block';
            document.getElementById('reportOutput').scrollIntoView({ behavior: 'smooth' });
        }
        
        // Initialize with current date
        document.getElementById('analysisDate').value = new Date().toISOString().split('T')[0];
    </script>
</body>
</html>
